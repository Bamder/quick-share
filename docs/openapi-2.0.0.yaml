# openapi-2.0.0.yaml
openapi: 3.0.3
info:
  title: æ–‡ä»¶é—ªä¼ ç³»ç»ŸAPI
  description: |
    # æ–‡ä»¶é—ªä¼ ç³»ç»Ÿ API æ–‡æ¡£ï¼ˆç‰ˆæœ¬2.0.0ï¼‰
    
    ## ğŸ¯ é¡¹ç›®æ¦‚è¿°
    
    åŸºäºå–ä»¶ç çš„åŒ¿åP2Pæ–‡ä»¶åˆ†äº«ç³»ç»Ÿï¼Œä½¿ç”¨WebRTCå®ç°ç‚¹å¯¹ç‚¹æ–‡ä»¶ä¼ è¾“ã€‚
    
    ### æ ¸å¿ƒæµç¨‹
    1. **ä¸Šä¼ æ–¹**ï¼šç”Ÿæˆå–ä»¶ç  â†’ ç­‰å¾…è¿æ¥
    2. **ä¸‹è½½æ–¹**ï¼šè¾“å…¥å–ä»¶ç  â†’ è·å–æ–‡ä»¶ä¿¡æ¯ â†’ å»ºç«‹WebRTCè¿æ¥
    3. **ä¼ è¾“**ï¼šP2Pæ–‡ä»¶ä¼ è¾“ â†’ æ›´æ–°çŠ¶æ€ â†’ ä¼ è¾“å®Œæˆ
    
    ---
    
    ## ğŸ—ï¸ æŠ€æœ¯æ¶æ„
    
    ### å‰ç«¯ç»„ï¼ˆå®¢æˆ·ç«¯ï¼‰
    - **æŠ€æœ¯æ ˆ**ï¼šReact/Vue + WebRTC
    - **èŒè´£**ï¼š
      - ç”¨æˆ·ç•Œé¢å’Œäº¤äº’
      - WebRTCè¿æ¥å»ºç«‹å’Œç»´æŠ¤
      - ICEå€™é€‰çš„å®æ—¶å‘é€å’Œæ¥æ”¶
      - æ–‡ä»¶åˆ†å—ä¼ è¾“å’Œè¿›åº¦æ˜¾ç¤º
    
    ### ç«¯å£ç»„ï¼ˆåç«¯APIï¼‰
    - **æŠ€æœ¯æ ˆ**ï¼šFastAPI (Python 3.10+)
    - **èŒè´£**ï¼š
      - å®ç°æœ¬æ–‡æ¡£æ‰€æœ‰RESTful APIæ¥å£
      - æ•°æ®åº“CRUDæ“ä½œ
      - ä¿¡ä»¤æœåŠ¡å™¨åŠŸèƒ½
      - è¾“å…¥éªŒè¯å’Œé”™è¯¯å¤„ç†
    
    ### æ•°æ®åº“ç»„ï¼ˆæ•°æ®å­˜å‚¨ï¼‰
    - **æŠ€æœ¯æ ˆ**ï¼šMySQL 8.0+
    - **èŒè´£**ï¼š
      - ç»´æŠ¤æ•°æ®åº“è¡¨ç»“æ„
      - ç¡®ä¿æ•°æ®ä¸€è‡´æ€§å’Œå®Œæ•´æ€§
      - æä¾›æ•°æ®æŸ¥è¯¢æ”¯æŒ
      - æ•°æ®åº“è¿ç§»ç®¡ç†
    
    ### ç®—æ³•ç»„ï¼ˆä¼˜åŒ–ç®—æ³•ï¼‰
    - **æŠ€æœ¯æ ˆ**ï¼šPython/JavaScript
    - **èŒè´£**ï¼š
      - WebRTCè¿æ¥æˆåŠŸç‡ä¼˜åŒ–
      - ICEå€™é€‰æ”¶é›†å’Œé€‰æ‹©ç®—æ³•
      - P2Pä¼ è¾“æ€§èƒ½ä¼˜åŒ–
      - æ–‡ä»¶åˆ†å—å’Œæ ¡éªŒç®—æ³•
    
    ---
    
    ## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„ï¼ˆå·²ç¡®è®¤ï¼‰
    
    ### æ ¸å¿ƒè¡¨
    1. **files** - æ–‡ä»¶ä¿¡æ¯è¡¨
    2. **pickup_codes** - å–ä»¶ç è¡¨ï¼ˆä¸»é”®ï¼šcode VARCHAR(6) å¿…é¡»å¤§å†™ï¼‰
    3. **webrtc_sessions** - WebRTCä¼šè¯è¡¨
    4. **registered_senders** - æ³¨å†Œå‘é€æ–¹è¡¨
    5. **reports** - ä¸¾æŠ¥è®°å½•è¡¨
    
    ### å…³é”®çº¦æŸ
    - æ‰€æœ‰è¡¨éƒ½æœ‰ created_at, updated_at å­—æ®µ
    - å–ä»¶ç å¿…é¡»6ä½å¤§å†™å­—æ¯æˆ–æ•°å­—ï¼ˆæ­£åˆ™ï¼š^[A-Z0-9]{6}$ï¼‰
    - webrtc_sessions æœ‰å”¯ä¸€çº¦æŸï¼šcode + session_id
    
    ---
    
    ## ğŸ”§ å…³é”®æŠ€æœ¯å†³ç­–
    
    ### 1. ICEå€™é€‰ä¼ è¾“ç­–ç•¥
    - **æ–¹æ¡ˆ**ï¼šå•ç‹¬æ¥å£å®æ—¶å‘é€ï¼ˆWebRTCæœ€ä½³å®è·µï¼‰
    - **ç†ç”±**ï¼šæé«˜è¿æ¥æˆåŠŸç‡ï¼Œé™ä½å»¶è¿Ÿ
    - **æ¥å£**ï¼š
      - POST /ice-candidate - å‘é€ICEå€™é€‰
      - GET /ice-candidates - è·å–ICEå€™é€‰åˆ—è¡¨
    
    ### 2. è§’è‰²å®šä¹‰
    - **Receiverï¼ˆæ¥æ”¶æ–¹/ä¸‹è½½æ–¹ï¼‰**ï¼šåˆ›å»ºOfferï¼Œè·å–Answerï¼Œæ¥æ”¶æ–‡ä»¶
    - **Senderï¼ˆå‘é€æ–¹/ä¸Šä¼ æ–¹ï¼‰**ï¼šæ³¨å†Œï¼Œè·å–Offerï¼Œåˆ›å»ºAnswerï¼Œå‘é€æ–‡ä»¶
    
    ### 3. æ•°æ®åº“æ“ä½œ
    - æ‰€æœ‰æ¥å£å¯¹åº”å…·ä½“çš„æ•°æ®åº“è¡¨æ“ä½œ
    - ä½¿ç”¨SQLAlchemy ORMæ¨¡å‹ï¼ˆå·²å®ç°ï¼‰
    
    ---
    
    ## ğŸ› ï¸ å„å°ç»„éœ€äº¤ä»˜
    
    ### ç«¯å£ç»„
     1. æŒ‰æœ¬æ–‡æ¡£å®ç°æ‰€æœ‰APIæ¥å£
     2. ç»Ÿä¸€çš„å“åº”æ ¼å¼å’Œé”™è¯¯å¤„ç†
     3. æ•°æ®åº“æ“ä½œçš„å®Œæ•´å®ç°
     4. è¾“å…¥éªŒè¯å’Œå®‰å…¨é˜²æŠ¤
    
    ### å‰ç«¯ç»„
     1. ç”¨æˆ·ç•Œé¢ï¼ˆä¸Šä¼ /ä¸‹è½½é¡µé¢ï¼‰
     2. WebRTCè¿æ¥ç®¡ç†å™¨
     3. ICEå€™é€‰å®æ—¶å¤„ç†
     4. æ–‡ä»¶ä¼ è¾“è¿›åº¦æ˜¾ç¤º
    
    ### æ•°æ®åº“ç»„
     1. å®Œæ•´çš„æ•°æ®åº“è¡¨ç»“æ„
     2. æµ‹è¯•æ•°æ®åˆå§‹åŒ–è„šæœ¬
     3. æ•°æ®åº“è¿ç§»æ–¹æ¡ˆ
    
    ### ç®—æ³•ç»„
     1. WebRTCè¿æ¥ä¼˜åŒ–ç®—æ³•
     2. ICEå€™é€‰é€‰æ‹©ç­–ç•¥
     3. æ–‡ä»¶ä¼ è¾“æ€§èƒ½åˆ†ææŠ¥å‘Š
    
    ---
    
    ## ğŸ“‹ æ¥å£æµ‹è¯•æ•°æ®
    
    ### å¯ç”¨å–ä»¶ç ï¼ˆæ•°æ®åº“å·²å­˜åœ¨ï¼‰
    | å–ä»¶ç  | çŠ¶æ€ | æ–‡ä»¶ | ä½¿ç”¨æƒ…å†µ |
    |--------|------|------|----------|
    | WAIT01 | ç­‰å¾…ä¸­ | æµ‹è¯•æ–‡ä»¶1.pdf | 0/3 |
    | TRAN02 | ä¼ è¾“ä¸­ | æµ‹è¯•å›¾ç‰‡.jpg | 1/3 |
    | DONE03 | å·²å®Œæˆ | æµ‹è¯•æ–‡ä»¶1.pdf | 3/3 |
    | EXPI04 | å·²è¿‡æœŸ | æµ‹è¯•å›¾ç‰‡.jpg | 1/3 |
    | INFIN5 | ç­‰å¾…ä¸­ | é¡¹ç›®æŠ¥å‘Š.pdf | 0/999 |
    
    ### WebRTCä¼šè¯
    - WAIT01 + sess_wait01: offer_created
    - TRAN02 + sess_tran02: answer_received
    
  version: "2.0.0"

servers:
  - url: http://localhost:8000
    description: å¼€å‘ç¯å¢ƒ
  - url: http://localhost:8000/api/v1
    description: å¸¦APIå‰ç¼€çš„å¼€å‘ç¯å¢ƒ

tags:
  - name: ç³»ç»ŸçŠ¶æ€
    description: æœåŠ¡å¥åº·æ£€æŸ¥
  - name: å–ä»¶ç ç®¡ç†
    description: å–ä»¶ç çŠ¶æ€æŸ¥è¯¢ã€æ–‡ä»¶ä¿¡æ¯è·å–ã€ä½¿ç”¨æ¬¡æ•°ç®¡ç†
  - name: WebRTCä¿¡ä»¤
    description: WebRTCè¿æ¥çš„ä¿¡ä»¤äº¤æ¢ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
  - name: ICEå€™é€‰ä¼ è¾“
    description: WebRTC ICEå€™é€‰çš„å®æ—¶ä¼ è¾“ï¼ˆå•ç‹¬æ¥å£ï¼‰
  - name: å®‰å…¨ç®¡ç†
    description: ä¸¾æŠ¥è¿è§„æ–‡ä»¶

paths:
  # ==================== ç³»ç»ŸçŠ¶æ€ ====================
  /health:
    get:
      tags:
        - ç³»ç»ŸçŠ¶æ€
      summary: æœåŠ¡å¥åº·æ£€æŸ¥
      description: æ£€æŸ¥APIæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
      operationId: checkHealth
      responses:
        '200':
          description: æœåŠ¡æ­£å¸¸
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
              example:
                code: 200
                msg: æœåŠ¡è¿è¡Œæ­£å¸¸
                data:
                  status: healthy
                  timestamp: "2025-12-26T13:00:00.000Z"
                  version: "2.0.0"

  # ==================== å–ä»¶ç ç®¡ç† ====================
  /api/v1/codes/{code}/status:
    get:
      tags:
        - å–ä»¶ç ç®¡ç†
      summary: æŸ¥è¯¢å–ä»¶ç çŠ¶æ€
      description: æ ¹æ®å–ä»¶ç æŸ¥è¯¢æ–‡ä»¶åˆ†äº«çŠ¶æ€
      operationId: getCodeStatus
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
            pattern: '^[A-Z0-9]{6}$'
            example: WAIT01
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
              example:
                code: 200
                msg: success
                data:
                  code: "WAIT01"
                  fileName: "æµ‹è¯•æ–‡ä»¶1.pdf"
                  fileSize: 1048576
                  status: "waiting"
                  usedCount: 0
                  limitCount: 3
                  expireAt: "2025-12-26T14:16:09.000Z"
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/codes/{code}/file-info:
    get:
      tags:
        - å–ä»¶ç ç®¡ç†
      summary: è·å–æ–‡ä»¶è¯¦ç»†ä¿¡æ¯
      description: æ ¹æ®å–ä»¶ç è·å–æ–‡ä»¶çš„å®Œæ•´ä¿¡æ¯
      operationId: getFileInfo
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
            pattern: '^[A-Z0-9]{6}$'
            example: WAIT01
      responses:
        '200':
          description: è·å–æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
              example:
                code: 200
                msg: success
                data:
                  fileId: 1
                  originalName: "æµ‹è¯•æ–‡ä»¶1.pdf"
                  size: 1048576
                  mimeType: "application/pdf"
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/codes/{code}/usage:
    post:
      tags:
        - å–ä»¶ç ç®¡ç†
      summary: å¢åŠ ä½¿ç”¨æ¬¡æ•°
      description: æ–‡ä»¶è¢«æˆåŠŸé¢†å–æ—¶è°ƒç”¨ï¼Œå¢åŠ å–ä»¶ç çš„ä½¿ç”¨æ¬¡æ•°
      operationId: incrementUsage
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
            pattern: '^[A-Z0-9]{6}$'
            example: WAIT01
      responses:
        '200':
          description: ä½¿ç”¨æ¬¡æ•°å¢åŠ æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
              example:
                code: 200
                msg: ä½¿ç”¨æ¬¡æ•°å·²æ›´æ–°
                data:
                  code: "WAIT01"
                  usedCount: 1
                  limitCount: 3
                  remaining: 2
        '400':
          description: å·²è¾¾åˆ°ä½¿ç”¨ä¸Šé™
          content:
            application/json:
              example:
                code: 400
                msg: å·²è¾¾åˆ°ä½¿ç”¨ä¸Šé™
                data:
                  code: "DONE03"
                  usedCount: 3
                  limitCount: 3

  # ==================== WebRTCä¿¡ä»¤ ====================
  /api/v1/codes/{code}/webrtc/sender/register:
    post:
      tags:
        - WebRTCä¿¡ä»¤
      summary: å‘é€æ–¹(Sender)æ³¨å†Œ
      description: å‘é€æ–¹å‘ä¿¡ä»¤æœåŠ¡å™¨æ³¨å†Œï¼Œå‡†å¤‡æ¥æ”¶Offer
      operationId: registerSender
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
            pattern: '^[A-Z0-9]{6}$'
            example: WAIT01
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SenderRegisterRequest'
      responses:
        '201':
          description: Senderæ³¨å†ŒæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
              example:
                code: 201
                msg: "Senderæ³¨å†ŒæˆåŠŸï¼Œç­‰å¾…Offer"
                data:
                  registeredAt: "2025-12-26T13:00:00.000Z"
                  expiresIn: 300
        '400':
          $ref: '#/components/responses/BadRequest'

  /api/v1/codes/{code}/webrtc/offer:
    post:
      tags:
        - WebRTCä¿¡ä»¤
      summary: æ¥æ”¶æ–¹(Receiver)åˆ›å»ºWebRTC Offer
      description: æ¥æ”¶æ–¹åˆ›å»ºWebRTC SDP Offerå¹¶å­˜å‚¨åˆ°æœåŠ¡å™¨
      operationId: createWebRTCOffer
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
            pattern: '^[A-Z0-9]{6}$'
            example: WAIT01
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebRTCOfferRequest'
      responses:
        '201':
          description: Offeråˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
              example:
                code: 201
                msg: "WebRTC Offeråˆ›å»ºæˆåŠŸ"
                data:
                  sessionId: "sess_wait01"
                  expiresIn: 300
                  status: "offer_created"
        '400':
          $ref: '#/components/responses/BadRequest'

  /api/v1/codes/{code}/webrtc/offer/{session_id}:
    get:
      tags:
        - WebRTCä¿¡ä»¤
      summary: å‘é€æ–¹(Sender)è·å–WebRTC Offer
      description: å‘é€æ–¹è·å–æ¥æ”¶æ–¹åˆ›å»ºçš„WebRTC SDP Offer
      operationId: getWebRTCOffer
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
            pattern: '^[A-Z0-9]{6}$'
            example: WAIT01
        - name: session_id
          in: path
          required: true
          schema:
            type: string
            example: "sess_wait01"
      responses:
        '200':
          description: è·å–æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
              example:
                code: 200
                msg: "success"
                data:
                  offer: "v=0\r\no=- 123456 2 IN IP4 127.0.0.1..."
                  status: "offer_created"
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/codes/{code}/webrtc/answer:
    post:
      tags:
        - WebRTCä¿¡ä»¤
      summary: å‘é€æ–¹(Sender)æäº¤WebRTC Answer
      description: |
        å‘é€æ–¹åˆ›å»ºå¹¶æäº¤WebRTC SDP Answerã€‚
        
        **æ³¨æ„**ï¼šICEå€™é€‰åº”é€šè¿‡ä¸“é—¨çš„ICEå€™é€‰æ¥å£å‘é€ï¼Œæ­¤æ¥å£çš„iceCandidateså­—æ®µä»…ç”¨äºä¼ è¾“å¿…è¦çš„å€™é€‰ä¿¡æ¯ã€‚
      operationId: submitWebRTCAnswer
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
            pattern: '^[A-Z0-9]{6}$'
            example: WAIT01
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebRTCAnswerRequest'
      responses:
        '200':
          description: Answeræäº¤æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
              example:
                code: 200
                msg: "WebRTC Answeræäº¤æˆåŠŸ"
                data:
                  sessionId: "sess_wait01"
                  status: "answer_received"
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/codes/{code}/webrtc/answer/{session_id}:
    get:
      tags:
        - WebRTCä¿¡ä»¤
      summary: æ¥æ”¶æ–¹(Receiver)è·å–WebRTC Answer
      description: æ¥æ”¶æ–¹è·å–å‘é€æ–¹åˆ›å»ºçš„WebRTC SDP Answer
      operationId: getWebRTCAnswer
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
            pattern: '^[A-Z0-9]{6}$'
            example: WAIT01
        - name: session_id
          in: path
          required: true
          schema:
            type: string
            example: "sess_wait01"
      responses:
        '200':
          description: è·å–æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
              example:
                code: 200
                msg: "success"
                data:
                  answer: "v=0\r\no=- 654321 2 IN IP4 127.0.0.1..."
                  status: "answer_received"
        '404':
          description: Answerä¸å­˜åœ¨æˆ–æœªåˆ›å»º
          content:
            application/json:
              example:
                code: 404
                msg: "WebRTC Answerä¸å­˜åœ¨æˆ–æœªåˆ›å»º"
                data:
                  status: "offer_created"
                  message: "ç­‰å¾…Senderåˆ›å»ºAnswer"

  # ==================== ICEå€™é€‰ä¼ è¾“ ====================
  /api/v1/codes/{code}/webrtc/ice-candidate:
    post:
      tags:
        - ICEå€™é€‰ä¼ è¾“
      summary: å‘é€ICEå€™é€‰
      description: |
        å‘é€WebRTC ICEå€™é€‰ä¿¡æ¯ã€‚
        
        **ä½¿ç”¨åœºæ™¯**ï¼š
        1. Senderåœ¨åˆ›å»ºAnsweråï¼Œå®æ—¶å‘é€æ”¶é›†åˆ°çš„ICEå€™é€‰
        2. Receiveråœ¨æ”¶åˆ°Answeråï¼Œä¹Ÿå¯ä»¥å‘é€è‡ªå·±çš„ICEå€™é€‰
        3. æ”¯æŒåŒå‘ICEå€™é€‰äº¤æ¢
        
        **ä¼ è¾“ç­–ç•¥**ï¼š
        - ICEå€™é€‰ç”Ÿæˆåç«‹å³å‘é€ï¼Œæé«˜è¿æ¥æˆåŠŸç‡
        - æ”¯æŒå¤šä¸ªå€™é€‰çš„è¿ç»­å‘é€
        - æœåŠ¡å™¨ä¼šå®æ—¶è½¬å‘ç»™å¯¹æ–¹
      operationId: sendIceCandidate
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
            pattern: '^[A-Z0-9]{6}$'
            example: WAIT01
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IceCandidateRequest'
            example:
              sessionId: "sess_wait01"
              candidate:
                candidate: "candidate:1 1 UDP 2122252543 192.168.1.200 5000 typ host"
                sdpMid: "0"
                sdpMLineIndex: 0
              role: "sender"  # senderæˆ–receiver
      responses:
        '200':
          description: ICEå€™é€‰æ¥æ”¶æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
              example:
                code: 200
                msg: "ICEå€™é€‰æ¥æ”¶æˆåŠŸ"
                data:
                  receivedAt: "2025-12-26T13:00:10.000Z"
                  candidateCount: 5
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/codes/{code}/webrtc/ice-candidates/{session_id}:
    get:
      tags:
        - ICEå€™é€‰ä¼ è¾“
      summary: è·å–ICEå€™é€‰åˆ—è¡¨
      description: |
        è·å–å¯¹ç­‰æ–¹å‘é€çš„æ‰€æœ‰ICEå€™é€‰ã€‚
        
        **ä½¿ç”¨æ–¹å¼**ï¼š
        - è½®è¯¢æ­¤æ¥å£è·å–æœ€æ–°çš„ICEå€™é€‰
        - æ¯æ¬¡è°ƒç”¨è¿”å›è‡ªä¸Šæ¬¡è¯·æ±‚åçš„æ–°å€™é€‰
        - å¯é€šè¿‡WebSocketä¼˜åŒ–ï¼ˆæœªæ¥ç‰ˆæœ¬ï¼‰
      operationId: getIceCandidates
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
            pattern: '^[A-Z0-9]{6}$'
            example: WAIT01
        - name: session_id
          in: path
          required: true
          schema:
            type: string
            example: "sess_wait01"
      responses:
        '200':
          description: è·å–æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
              example:
                code: 200
                msg: "success"
                data:
                  candidates:
                    - candidate: "candidate:1 1 UDP 2122252543 192.168.1.200 5000 typ host"
                      sdpMid: "0"
                      sdpMLineIndex: 0
                    - candidate: "candidate:2 1 UDP 1686052863 203.0.113.1 5000 typ srflx"
                      sdpMid: "0"
                      sdpMLineIndex: 0
                  count: 2
                  lastUpdated: "2025-12-26T13:00:15.000Z"
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== å®‰å…¨ç®¡ç† ====================
  /api/v1/reports:
    post:
      tags:
        - å®‰å…¨ç®¡ç†
      summary: ä¸¾æŠ¥è¿è§„æ–‡ä»¶
      description: ä¸¾æŠ¥è¿è§„ã€ä¾µæƒæˆ–ä¸å½“å†…å®¹æ–‡ä»¶
      operationId: reportFile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReportRequest'
      responses:
        '201':
          description: ä¸¾æŠ¥å·²å—ç†
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
              example:
                code: 201
                msg: "ä¸¾æŠ¥å·²å—ç†ï¼Œæ„Ÿè°¢æ‚¨çš„åé¦ˆ"
                data:
                  reportId: 1
                  reportedAt: "2025-12-26T13:00:00.000Z"
        '400':
          $ref: '#/components/responses/BadRequest'

components:
  schemas:
    # æ ‡å‡†å“åº”æ ¼å¼
    StandardResponse:
      type: object
      required:
        - code
        - msg
      properties:
        code:
          type: integer
          description: çŠ¶æ€ç 
          enum: [200, 201, 400, 404, 429, 500]
          example: 200
        msg:
          type: string
          description: çŠ¶æ€æ¶ˆæ¯
          example: success
        data:
          type: object
          description: å“åº”æ•°æ®
          nullable: true

    # Senderæ³¨å†Œè¯·æ±‚
    SenderRegisterRequest:
      type: object
      required:
        - senderInfo
      properties:
        senderInfo:
          type: object
          required:
            - userAgent
            - ipAddress
          properties:
            userAgent:
              type: string
            ipAddress:
              type: string
            platform:
              type: string
        callbackUrl:
          type: string
          format: uri

    # WebRTC Offerè¯·æ±‚
    WebRTCOfferRequest:
      type: object
      required:
        - sessionId
        - offer
      properties:
        sessionId:
          type: string
          minLength: 1
          maxLength: 64
        offer:
          type: string
          minLength: 1
        receiverInfo:
          type: object
          properties:
            userAgent:
              type: string
            ipAddress:
              type: string

    # WebRTC Answerè¯·æ±‚
    WebRTCAnswerRequest:
      type: object
      required:
        - sessionId
        - answer
      properties:
        sessionId:
          type: string
        answer:
          type: string
        iceCandidates:
          type: array
          description: |
            åˆå§‹ICEå€™é€‰ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰ã€‚
            
            **æ³¨æ„**ï¼šå®Œæ•´çš„ICEå€™é€‰åº”é€šè¿‡ä¸“é—¨çš„ICEå€™é€‰æ¥å£å‘é€ã€‚
            æ­¤å¤„ä»…ç”¨äºä¼ è¾“å¿…è¦çš„åˆå§‹å€™é€‰ã€‚
          items:
            type: object
            properties:
              candidate:
                type: string
              sdpMid:
                type: string
              sdpMLineIndex:
                type: integer

    # ICEå€™é€‰è¯·æ±‚
    IceCandidateRequest:
      type: object
      required:
        - sessionId
        - candidate
      properties:
        sessionId:
          type: string
          description: ä¼šè¯ID
        candidate:
          type: object
          description: ICEå€™é€‰å¯¹è±¡
          required:
            - candidate
          properties:
            candidate:
              type: string
              description: ICEå€™é€‰å­—ç¬¦ä¸²
            sdpMid:
              type: string
              description: SDPåª’ä½“æ ‡è¯†
            sdpMLineIndex:
              type: integer
              description: SDPåª’ä½“è¡Œç´¢å¼•
        role:
          type: string
          description: å‘é€æ–¹è§’è‰²
          enum: [sender, receiver]
          default: sender

    # ä¸¾æŠ¥è¯·æ±‚
    ReportRequest:
      type: object
      required:
        - code
        - reason
      properties:
        code:
          type: string
          pattern: '^[A-Z0-9]{6}$'
        reason:
          type: string
          minLength: 1
          maxLength: 500
        reporterInfo:
          type: object
          properties:
            userAgent:
              type: string
            ipAddress:
              type: string

  responses:
    BadRequest:
      description: è¯·æ±‚å‚æ•°é”™è¯¯
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/StandardResponse'
          example:
            code: 400
            msg: è¯·æ±‚å‚æ•°é”™è¯¯
            data: null

    NotFound:
      description: èµ„æºæœªæ‰¾åˆ°
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/StandardResponse'
          example:
            code: 404
            msg: èµ„æºä¸å­˜åœ¨
            data: null

    ServerError:
      description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/StandardResponse'
          example:
            code: 500
            msg: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
            data: null

    RateLimit:
      description: è¯·æ±‚é¢‘ç‡è¶…é™
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/StandardResponse'
          example:
            code: 429
            msg: è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•
            data:
              retryAfter: 60

# å®‰å…¨å®šä¹‰ï¼ˆå½“å‰ç‰ˆæœ¬æ— éœ€è®¤è¯ï¼‰
security: []